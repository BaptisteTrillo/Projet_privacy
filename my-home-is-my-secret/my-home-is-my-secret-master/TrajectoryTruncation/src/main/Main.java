var WSB;(function(n){let r;(function(n){n[n.ResponseJsonParseError=-2]="ResponseJsonParseError";n[n.ReadResponseError=-3]="ReadResponseError";n[n.ReadErrorStatusResponseError=-4]="ReadErrorStatusResponseError";n[n.NoToken=-5]="NoToken";n[n.FetchError=-6]="FetchError";n[n.UncaughtError=-7]="UncaughtError";n[n.NoMsbLokiAccessToken=-8]="NoMsbLokiAccessToken";n[n.Aborted=-9]="Aborted";n[n.TimedOut=-11]="TimedOut";n[n.XhrError=-12]="XhrError";n[n.XhrCompleted=-13]="XhrCompleted";n[n.MsbTokenExpiredBeforeRequest=-14]="MsbTokenExpiredBeforeRequest";n[n.UrlUnavailable=-15]="UrlUnavailable";n[n.RefreshTokenFailure=-16]="RefreshTokenFailure";n[n.MsbHttpBuildApiParameterError=-17]="MsbHttpBuildApiParameterError"})(r=n.ClientErrorCode||(n.ClientErrorCode={}));let t;(function(n){n[n.Unknown=0]="Unknown";n[n.Enabled=1]="Enabled";n[n.Disabled=2]="Disabled"})(t=n.TenantMsbStatus||(n.TenantMsbStatus={}));n.MsbStateExpiryTimeInMs=432e6;const u=50;n.ZiRecommendedDocsResultsCount=3;class i{static init(){this.isMsbSupported()&&(n.msbHost=new i)}static isMsbSupported(){return n.RuntimeConfig.EntryPointApp==0&&!(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.msbOff)&&n.config.msbEnabled}constructor(){this.midgardLanguageChecked=!1;n.config.msbEnableAccountManager?(this.accountCache=new n.MsbAccountCache,this.accountManager=new n.MsbAccountManager(n.getAccessTokenManager()),this.verticalManager=new n.MsbVerticalManager2(this.accountManager)):(this.tokenManager=new n.MsbTokenManager(n.getAccessTokenManager()),this.tenantManager=new n.MsbTenantManager(this.tokenManager),this.verticalManager=new n.MsbVerticalManager(this.tokenManager,this.tenantManager),this.userConfigManager=new n.MsbUserConfigManager(this.tokenManager,this.tenantManager));this.features=new n.MsbFeatureUtils;this.httpWrapper=new n.MsbHttpWrapper;this.dataAccess=new n.MsbDataAccess;this.prefetchManager=new n.MsbPrefetchManager;this.substrateLogger=new n.MsbSubstrateLogger;n.config.msbDsbEnableBlendFeature&&(this.settingsManager=new n.MsbSettingsManager);this.proactiveSearchManager=new n.MsbProactiveSearchManager;this.photoManager=new n.MsbPhotoManager;this.qfUtils=new n.MsbQfUtils;this.urlUtils=new n.MsbUrlUtils;this.iconUtils=new n.MsbIconUtils;n.config.msbEnableAccountManager&&n.config.msbLoadQfScriptEarly&&n.safeSetTimeout(()=>{n.msbHost.shouldForceEnterprise()&&_w.postMessage({messageType:"BingAtWork:WsbQfScriptLoad"},_w.location.origin)},u,"MsbTokenManager Constructor");n.config.msbEnableChatUpsell&&(this.msbWorkChatUtils=new n.MsbWorkChatUtils);n.config.msbEnableAccountManager&&this.accountManager.bindAccountStatusChanged(async t=>{const{changeType:r,previousAccount:i}=t;switch(r){case"AccountSwitchStarted":i&&n.Host.clearWorkQuery();break;case"AccountSwitchEnd":i&&n.Host.refreshCurrentPane(!0);n.Host.updateScopeList()}})}getClientType(t){let i="Wsb";return t===n.Scope.Work&&(i="WsbBingVertical"),i}isTenantMsbEnabled(){var t,i;return n.config.msbEnableAccountManager?(i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.tenantSettings.data)===null||i===void 0?void 0:i.isEnabled:n.msbHost.tenantManager.isTenantMsbEnabled()}getTenantMsbStatus(){var i,r;if(n.config.msbEnableAccountManager){const n=(r=(i=this.accountManager.getCurrentAccount())===null||i===void 0?void 0:i.tenantSettings.data)===null||r===void 0?void 0:r.isEnabled;return n===!0?t.Enabled:n===!1?t.Disabled:t.Unknown}return n.msbHost.tenantManager.getTenantMsbStatus()}isMsbInternalTenant(){var t,i;return n.config.msbEnableAccountManager?(i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.tenantSettings.data)===null||i===void 0?void 0:i.isMsitInternal:n.msbHost.tenantManager.getIsMsbInternalTenant()}isEduTenant(){var t;if(n.config.msbEnableAccountManager){const i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.tenantSettings.data,r=i===null||i===void 0?void 0:i.isEnabled,u=i===null||i===void 0?void 0:i.isEdu;return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbEDUTenant)?r:r&&u}return n.msbHost.tenantManager.getIsMsbEduTenantEnabled()}isGccTenant(){var t,i;return n.config.msbEnableAccountManager?!!((i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.authInfo.data)===null||i===void 0?void 0:i.gccRegion):n.msbHost.tenantManager.isGccTenant()}isGccModerateTenant(){var t,i;if(n.config.msbEnableAccountManager)return((i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.authInfo.data)===null||i===void 0?void 0:i.gccRegion)===1;throw new Error("New code behind MsbAccountManager");}isGccHighTenant(){var t,i;if(n.config.msbEnableAccountManager){const n=(i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.authInfo.data)===null||i===void 0?void 0:i.gccRegion;return n===2||n===3}return n.msbHost.tenantManager.isGccHighTenant()}getTenantName(){var t,i,r,u,f,e,o;if(n.config.msbEnableAccountManager){const e=this.accountManager.getCurrentAccount();return(f=(u=(i=(t=e===null||e===void 0?void 0:e.tenantSettings.data)===null||t===void 0?void 0:t.tenantName)!==null&&i!==void 0?i:(r=e===null||e===void 0?void 0:e.authInfo.data)===null||r===void 0?void 0:r.tenantName)!==null&&u!==void 0?u:n.SubstrateTenantName)!==null&&f!==void 0?f:""}return(o=(e=n.msbHost.tenantManager.getStoredMsbTenantName())!==null&&e!==void 0?e:n.SubstrateTenantName)!==null&&o!==void 0?o:""}isIconUrlEnabled(t){return!!(t&&n.config.msbEnableIconUrl)}tenantHasLogo(){var t;if(n.config.msbEnableAccountManager){const n=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.tenantSettings.data;if(!n)return!1;const{iconLargeDataUri:i,iconLargeIsDefault:r,iconUrl:u}=n;return!!(i&&!r||this.isIconUrlEnabled(u))}return n.msbHost.tenantManager.tenantHasLogo()}getTenantBranding(){if(n.config.msbEnableAccountManager){const n=this.accountManager.getCurrentAccount();if(!n)return undefined;const f=n.authInfo.data,t=n.tenantSettings.data;if(!f||!t)return undefined;const i=this.getTenantName(),{iconLargeDataUri:r,iconLargeIsDefault:e,iconUrl:u,themeBackColor:o,themeForeColor:s}=t;return r||i||this.isIconUrlEnabled(u)?{logoDataUri:r,iconLargeIsDefault:e,iconUrl:u,backColor:o,companyName:i,fontColor:s}:undefined}return n.msbHost.tenantManager.getMsbBranding()}getTenantVariants(){var t,i,r;if(n.config.msbEnableAccountManager){const n=(r=(i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.tenantSettings.data)===null||i===void 0?void 0:i.variants)!==null&&r!==void 0?r:[];return n.join(",")}return n.msbHost.tenantManager.getMsbTenantVariants()}isTenantRecentlyEnabled(){var t;if(n.config.msbEnableAccountManager){const i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.runtimeInfo.lastTenantSuccessEnabledTime;if(typeof i!="number")return undefined;const r=n.getCurrentTime()-i;return r<n.MsbStateExpiryTimeInMs}return this.tenantManager.isLastEnabledTimeValid()}shouldForceEnterprise(){var t,i;return n.config.msbEnableAccountManager?((i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.tenantSettings.data)===null||i===void 0?void 0:i.isEnabled)||this.isTenantRecentlyEnabled():n.msbHost.tenantManager.shouldForceEnterpriseAccount()}getAadUserInfo(){if(n.config.msbEnableAccountManager){const t=n.msbHost.accountManager.getCurrentAccount();if(!(t===null||t===void 0?void 0:t.authInfo.data))return undefined;const{tenantId:i,tenantName:r,userObjectId:u,userFirstName:f}=t.authInfo.data;return{tenantId:i,tenantName:r,userAadId:u,email:t.accountUserName,userFirstName:f}}return n.msbHost.tokenManager.getAadUserInfo()}mapRedirectTarget(t){if(n.config.msbEnableAccountManager)switch(t){case"RecommendedPeople":case"ExpandedOrgChart":return this.features.isWorkScopeDsbRedirectEnabled()?"Work":"People";case"PopularSearchesFeedFallback":return this.features.isWorkScopeDsbRedirectEnabled()?"Work":"Web";case"People":case"Bookmarks":return this.features.isWorkScopeSHRedirectEnabled()?"Work":"People";case"MFIL":return"Documents";case"MPPL":case"MGRP":return"People";case"MBKS":return"Web";default:return undefined}else return n.msbHost.tenantManager.redirectScope(t)}hasEduAssignments(){var t,i;return n.config.msbEnableAccountManager?(i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.userConfig.data)===null||i===void 0?void 0:i.hasEduAssignments:n.msbHost.userConfigManager.getHasEduAssignmentsFlags()}isEduHigherEducationTenant(){var t,i,r,u;return n.config.msbEnableAccountManager?this.isEduTenant()&&((r=(i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.userConfig.data)===null||i===void 0?void 0:i.industry)===null||r===void 0?void 0:r.includes("higher education")):(u=n.msbHost.userConfigManager)===null||u===void 0?void 0:u.isEduHigherEducationEnabled()}isEduK12Tenant(){var t,i,r,u;return n.config.msbEnableAccountManager?this.isEduTenant()&&((r=(i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.userConfig.data)===null||i===void 0?void 0:i.industry)===null||r===void 0?void 0:r.includes("k-12")):(u=n.msbHost.userConfigManager)===null||u===void 0?void 0:u.isEduK12Enabled()}isEduFacultyTenant(){var t,i,r,u;return n.config.msbEnableAccountManager?this.isEduTenant()&&((r=(i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.userConfig.data)===null||i===void 0?void 0:i.licenseNames)===null||r===void 0?void 0:r.includes("EduFaculty")):(u=n.msbHost.userConfigManager)===null||u===void 0?void 0:u.isEduLicenseEnabled("EduFaculty")}isWorkScope(t,i){return n.config.msbEnableAccountManager?this.features.isWorkScopeApplicable()&&(t===21||i==n.Scope.Work):n.msbHost.tenantManager.isMsbWorkScope(t,i)}getChatEligibility(){var t,i,r;return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbForceChatEligibility)&&this.msbWorkChatUtils.isValidTestHookEligibilityState(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbForceChatEligibility)?n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbForceChatEligibility:n.config.msbEnableAccountManager?(r=(i=(t=this.accountManager.getCurrentAccount())===null||t===void 0?void 0:t.authInfo.data)===null||i===void 0?void 0:i.chatEligibilityType)!==null&&r!==void 0?r:"None":n.msbHost.tokenManager.getChatEligibility()}async refreshMidgardResourcesListAsync(){try{const{midgardResources:t,qfResources:i}=BingAtWork!==null&&BingAtWork!==void 0?BingAtWork:{};((t===null||t===void 0?void 0:t.length)>0||(i===null||i===void 0?void 0:i.length)>0)&&n.isBrowserOnline()&&await this.downloadAndReplaceMidgardResourcesListAsync()}catch(t){this.logGeneralRefreshResourcesListError(t,"refreshMidgardResourcesListAsync")}}async downloadAndReplaceMidgardResourcesListAsync(){try{const i=this.urlUtils.getMidgardRsourcesListUrl(),r={method:"GET",url:i,skipToken:!0},{result:u}=await this.httpWrapper.sendHttpAsync(r),{midgardResources:n,qfResources:t}=u,{midgardResources:f,qfResources:e}=BingAtWork!==null&&BingAtWork!==void 0?BingAtWork:{},o=(n===null||n===void 0?void 0:n.length)>0?n:f,s=(t===null||t===void 0?void 0:t.length)>0?t:e;Object.assign(BingAtWork,{midgardResources:o,qfResources:s})}catch(t){const i="downloadAndReplaceMidgardResourcesListAsync",r=this.isMsbInternalTenant(),u="Wsb Refresh Midgard Resources List Failed";if(t instanceof n.MsbHttpError){const{message:f,stack:e,isBrowserOnline:o,hResultString:s,responseContext:h,innerError:c}=t,{statusCode:l,serverTraceId:a,requestSentTime:v,responseReceivedTime:y}=h,p=r?`innerError=${n.stringifyError(c)}`:"";_w.bfbWsbTel&&bfbWsbTel.logHttpError(u,f,{statusCode:l,stackTrace:e,serverTraceId:a,additionalMessage:p},{Online:o,HResult:s,ReqTS:v,ResTS:y,caller:i})}else this.logGeneralRefreshResourcesListError(t,i)}}logGeneralRefreshResourcesListError(t,i){const r=this.isMsbInternalTenant(),u=r?n.stringifyError(t):"";_w.bfbWsbTel&&bfbWsbTel.logError("Wsb Refresh Midgard Resources List Failed","non-HTTP",{additionalMessage:u},{Online:n.isBrowserOnline(),caller:i})}checkMidgardLanguage(){if(!this.midgardLanguageChecked)try{const t=this.getLowerCaseLangPart(this.getSystemLanguage()),i=this.getLowerCaseLangPart(this.getMidgardLanguage());if(t&&i&&t!=i){const t="MsbLangMis",i=n.LightweightStorage.getItem(t);if(i&&n.getCurrentTime()-Number(i)<864e5)return;const r=this.formatLanguageInfo();_w.bfbWsbTel&&bfbWsbTel.logError("Wsb Mi